<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Recebimento de Container</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            min-height: 100vh;
            padding: 20px;
            width: 100vw;
            overflow-x: auto;
        }

        .container {
            width: 100vw;
            max-width: 100vw;
            min-width: 0;
            margin: 0 auto;
            background: #252526;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            overflow: visible;
            border: 1px solid #3e3e42;
        }

        header {
            background: #007acc;
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #2d2d30;
            border-bottom: 2px solid #007acc;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #2d2d30;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            border-right: 1px solid #3e3e42;
            color: #cccccc;
            white-space: nowrap;
        }

        .tab:hover {
            background: #3e3e42;
            color: #ffffff;
        }

        .tab.active {
            background: #1e1e1e;
            color: #007acc;
            border-bottom: 3px solid #007acc;
        }

        .tab-content {
            display: none;
            padding: 30px;
            background: #1e1e1e;
            color: #cccccc;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #252526;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #3e3e42;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #cccccc;
            font-size: 14px;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        input[type="number"],
        select {
            padding: 12px;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: #1e1e1e;
            color: #cccccc;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #007acc;
            background: #252526;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007acc;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 122, 204, 0.4);
            background: #005a9e;
        }

        .btn-edit {
            background: #ffa726;
            color: white;
            padding: 6px 12px;
            font-size: 14px;
            margin-right: 5px;
        }

        .btn-delete {
            background: #ef5350;
            color: white;
            padding: 6px 12px;
            font-size: 14px;
        }

        .btn-import {
            background: #26a69a;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
            margin-right: 10px;
        }

        .btn-export {
            background: #42a5f5;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
        }

        .import-section {
            background: #252526;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #007acc;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .import-info {
            background: #2d2d30;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #007acc;
        }

        .import-info strong {
            display: block;
            margin-bottom: 8px;
            color: #007acc;
        }

        .import-info ul {
            margin-left: 20px;
            color: #cccccc;
        }

        .sub-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #3e3e42;
            padding-bottom: 10px;
        }

        .sub-tab {
            padding: 10px 20px;
            background: #2d2d30;
            border: none;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            color: #cccccc;
        }

        .sub-tab:hover {
            background: #3e3e42;
            color: #ffffff;
        }

        .sub-tab.active {
            background: #007acc;
            color: white;
        }

        .btn-status {
            background: #4caf50;
            color: white;
            padding: 6px 12px;
            font-size: 14px;
            margin-right: 5px;
        }

        .btn-status.entregue {
            background: #9e9e9e;
            cursor: not-allowed;
        }

        .filter-year {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #252526;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }

        .filter-year label {
            font-weight: 600;
            color: #cccccc;
        }

        .filter-year select {
            padding: 8px 15px;
            border: 1px solid #007acc;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #007acc;
            background: #1e1e1e;
            cursor: pointer;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 1px solid #3e3e42;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #252526;
            min-width: 1200px;
        }

        thead {
            background: #007acc;
            color: white;
        }

        th {
                height: 48px;
                text-align: center;
                vertical-align: middle;
                font-weight: 700;
                font-size: 17px;
                white-space: nowrap;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #3e3e42;
            font-size: 13px;
            color: #cccccc;
            text-align: center;
        }

        tbody tr:hover {
            background: #2d2d30;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-concluido {
            background: #d4edda;
            color: #155724;
        }

        .status-atrasado {
            background: #f8d7da;
            color: #721c24;
        }

        .search-box {
            margin-bottom: 20px;
            padding: 12px;
            width: 100%;
            max-width: 400px;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            font-size: 14px;
            background: #252526;
            color: #cccccc;
        }

        .search-box:focus {
            outline: none;
            border-color: #007acc;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #007acc;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #005a9e;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #858585;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .dia-card {
            background: #252526;
            border: 2px solid #3e3e42;
            border-radius: 10px;
            padding: 15px;
            min-height: 200px;
            transition: all 0.3s;
        }

        .dia-card:hover {
            border-color: #007acc;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 122, 204, 0.3);
        }

        .dia-card.hoje {
            border-color: #007acc;
            background: #1a3a52;
        }

        .dia-card-header {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #3e3e42;
            margin-bottom: 10px;
        }

        .dia-card-header h4 {
            color: #007acc;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .dia-card-header .data {
            color: #cccccc;
            font-size: 20px;
            font-weight: bold;
        }

        .container-item {
            background: #1e1e1e;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #007acc;
            font-size: 12px;
        }

        .container-item strong {
            color: #007acc;
            display: block;
            margin-bottom: 3px;
        }

        .container-item .produto {
            color: #cccccc;
            margin-bottom: 2px;
        }

        .container-item .quantidade {
            color: #4fc3f7;
            font-weight: bold;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-aguardando {
            background: #ffa726;
            color: white;
        }

        .status-processo {
            background: #42a5f5;
            color: white;
        }

        .status-concluido {
            background: #66bb6a;
            color: white;
        }

        .btn-status {
            background: #66bb6a;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Responsividade para o calend√°rio semanal - sem rolagem horizontal */
        #calendarioSemanal {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            width: 100%;
            min-width: 0;
            max-width: 100vw;
        }
        #calendarioSemanal .dia-card {
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
        }
        @media (max-width: 1200px) {
            #calendarioSemanal {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        @media (max-width: 900px) {
            #calendarioSemanal {
                grid-template-columns: 1fr !important;
            }
        }
        .dia-card-header h4, .dia-card-header .data {
            font-size: 1em;
        }
        .dia-card-body {
            font-size: 0.95em;
        }
        .dia-card-body p {
            text-align: center !important;
            margin: 0 auto;
        }

        /* Estilos para o bot√£o de login/logout */
        #login-area {
            position: absolute;
            top: 30px;
            right: 40px;
        }

        #loginBtn, #logoutBtn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        #loginBtn {
            background: #007acc;
            color: white;
        }

        #loginBtn:hover {
            background: #005a9e;
        }

        #logoutBtn {
            background: #ef5350;
            color: white;
        }

        #logoutBtn:hover {
            background: #c62828;
        }

        #userEmail {
            color: #fff;
            margin-left: 10px;
            font-size: 14px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Modal de Login -->
    <div id="modalLogin" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center;">
        <div style="background:#252526; padding:40px 30px 30px 30px; border-radius:12px; max-width:350px; margin:auto; box-shadow:0 8px 32px #0008; border:1px solid #3e3e42; position:relative;">
            <h2 style="color:#007acc; text-align:center; margin-bottom:20px;">Login</h2>
            <form id="formLogin" autocomplete="off">
                <div style="margin-bottom:15px;">
                    <label for="loginUsuario" style="color:#ccc; font-weight:600;">Usu√°rio</label>
                    <input type="text" id="loginUsuario" required style="width:100%; padding:10px; border-radius:6px; border:1px solid #3e3e42; background:#1e1e1e; color:#ccc;">
                </div>
                <div style="margin-bottom:20px;">
                    <label for="loginSenha" style="color:#ccc; font-weight:600;">Senha</label>
                    <input type="password" id="loginSenha" required style="width:100%; padding:10px; border-radius:6px; border:1px solid #3e3e42; background:#1e1e1e; color:#ccc;">
                </div>
                <div style="text-align:center;">
                    <button type="submit" class="btn btn-primary" style="width:100%;">Entrar</button>
                </div>
                <div id="loginErro" style="color:#ef5350; text-align:center; margin-top:10px; display:none;">Usu√°rio ou senha inv√°lidos!</div>
            </form>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üì¶ Sistema de Gest√£o de Recebimento de Container</h1>
            <p>Controle completo de importa√ß√µes e recebimentos</p>

            <!-- Bot√µes de Login/Logout -->
            <div id="login-area">
                <button id="loginBtn" class="btn btn-primary" onclick="abrirModalLogin()">Login</button>
                <button id="logoutBtn" class="btn btn-delete" onclick="logout()">Sair</button>
                <span id="userEmail" style="color:#fff; margin-left:10px; font-size:14px; display:none;"></span>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="openTab('planejador')">üìÖ Planejador Semanal</button>
            <button class="tab" onclick="openTab('consulta')">üìä Consulta</button>
            <button class="tab" onclick="openTab('cadastro')">üöö Cadastro</button>
            <button class="tab" onclick="openTab('dashboard')">üìà Dashboard</button>
        </div>

        <!-- ABA CONSULTA -->
        <div id="consulta" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #007acc;">Consulta de Registros</h2>
            
            <div class="import-section">
                <h3 style="margin-bottom: 15px; color: #007acc;">üì• Importar/Exportar Dados</h3>
                <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" onchange="importarArquivo(event)" style="display: none;">
                    <button class="btn btn-import" onclick="document.getElementById('fileInput').click()">üìÇ Importar Excel/CSV</button>
                    <button class="btn btn-export" onclick="exportarParaExcel()">üì§ Exportar para Excel</button>
                    <button class="btn btn-delete" onclick="limparTodosDados()">üóëÔ∏è Limpar Todos os Dados</button>
                    <button class="btn" style="background: #3e3e42; cursor: help;" title="Formato esperado do arquivo:&#10;‚Ä¢ Colunas: Ref. TBX | Containers | Vencimento armazenagem PORTO | Vencimento demurrage | Data da libera√ß√£o carregamento | Data carregamento | Entrada armaz√©m parceiro | Vencimento prazo no armaz√©m | Entrega TBX | Status | Obs | Transporte Porto x TBX | Arm. de container CHEIO | Arm. de container VAZIO | Janela especial | M√£o de obra para descarregamento | Lava√ß√£o container&#10;‚Ä¢ Formato de data: DD/MM/AAAA&#10;‚Ä¢ Suporta arquivos Excel (.xlsx, .xls) e CSV">‚ÑπÔ∏è Formato</button>
                </div>
            </div>

            <div class="sub-tabs">
                <button class="sub-tab active" onclick="filtrarPorStatus('pendente')">Containers Pendentes</button>
                <button class="sub-tab" onclick="filtrarPorStatus('entregue')">Containers Entregues</button>
                <button class="sub-tab" onclick="filtrarPorStatus('todos')">Todos os Containers</button>
                <button class="btn btn-status" onclick="marcarTodosComoEntregue()" style="margin-left: auto;">‚úÖ Marcar Todos como Entregue</button>
            </div>
            
            <input type="text" id="searchInput" class="search-box" placeholder="üîç Buscar por Ref. TBX, Container, Transportadora..." onkeyup="filtrarTabela()">
            
            <div class="table-container">
                <table id="containerTable">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Ref. TBX</th>
                            <th>N¬∞ Container</th>
                            <th>Venc. Porto</th>
                            <th>Data Libera√ß√£o</th>
                            <th>Data Carregamento</th>
                            <th>Venc. Demurrage</th>
                            <th>Entrega TBX</th>
                            <th>Previs√£o Descarga</th>
                            <th>Transportadora</th>
                            <th>Frete (R$)</th>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="12" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üì¶</div>
                                    <p>Nenhum registro encontrado. Adicione um novo registro na aba "Registro".</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Pagina√ß√£o -->
            <div id="paginacao"></div>
        </div>

        <!-- ABA CADASTRO -->
        <div id="cadastro" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #007acc;">Cadastro de Transportadoras</h2>
            
            <div class="form-section">
                <h3 style="margin-bottom: 15px; color: #007acc;">üÜï Nova Transportadora</h3>
                <form id="transportadoraForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nomeTransportadora">Nome da Transportadora *</label>
                            <input type="text" id="nomeTransportadora" required placeholder="Ex: TURASSI TRANSPORTES">
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: right;">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('transportadoraForm').reset()" style="background: #999; margin-right: 10px;">Limpar</button>
                        <button type="submit" class="btn btn-primary">üíæ Salvar Transportadora</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <h3 style="margin-bottom: 15px;">üöö Lista de Transportadoras Cadastradas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Nome da Transportadora</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="transportadorasTableBody">
                        <tr>
                            <td colspan="2" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üöö</div>
                                    <p>Nenhuma transportadora cadastrada. Adicione uma nova acima.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Cadastro de Par√¢metro de Pe√ßas por Pallet -->
            <div class="form-section" style="margin-top: 40px;">
                <h3 style="margin-bottom: 15px; color: #007acc;">üì¶ Par√¢metro: Pe√ßas por Pallet</h3>
                <form id="parametroPalletForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="codigoPallet">C√≥digo do Produto *</label>
                            <input type="text" id="codigoPallet" required placeholder="Ex: PVAB0002">
                        </div>
                        <div class="form-group">
                            <label for="quantidadePallet">Capacidade por local *</label>
                            <input type="number" id="quantidadePallet" required min="1" placeholder="Ex: 6">
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: right; display: flex; gap: 10px; justify-content: flex-end; align-items: center;">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('parametroPalletForm').reset()" style="background: #999;">Limpar</button>
                        <button type="submit" class="btn btn-primary">üíæ Salvar Par√¢metro</button>
                        <input type="file" id="importarParametrosPalletInput" accept=".xlsx,.xls,.csv" style="display:none;">
                        <button type="button" class="btn btn-import" onclick="document.getElementById('importarParametrosPalletInput').click()">üìÇ Importar Arquivo</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <h3 style="margin-bottom: 15px;">üì¶ Par√¢metros Cadastrados</h3>
                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Capacidade</th>
                            <th>Unidade</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="parametrosPalletTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üì¶</div>
                                    <p>Nenhum par√¢metro cadastrado. Adicione um novo acima.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ABA DASHBOARD -->
        <div id="dashboard" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #007acc;">Dashboard - Vis√£o Geral</h2>
            
            <div class="filter-year" style="margin-bottom: 20px;">
                <label for="filtroAnoDashboard">üìÖ Filtrar por Ano:</label>
                <select id="filtroAnoDashboard" onchange="atualizarDashboard()">
                    <option value="todos">Todos os Anos</option>
                </select>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalContainers">0</h3>
                    <p>Total de Containers</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3 id="totalFrete">R$ 0,00</h3>
                    <p>Total em Frete</p>
                </div>
            </div>

            <div class="table-container">
                <h3 style="margin-bottom: 15px;">üí∞ Frete por Transportadora</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Transportadora</th>
                            <th>Quantidade de Containers</th>
                            <th>Total em Frete (R$)</th>
                        </tr>
                    </thead>
                    <tbody id="freteTransportadoraBody">
                        <tr>
                            <td colspan="3" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üöö</div>
                                    <p>Nenhum dado dispon√≠vel.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-container" style="padding: 20px;">
                <h3 style="margin-bottom: 15px;">üìä An√°lise Mensal de Containers e Frete</h3>
                <canvas id="graficoMensal" style="max-height: 400px;"></canvas>
            </div>

            <div class="table-container">
                <h3 style="margin-bottom: 15px;">üì¶ Containers Recentes (Pendentes)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Ref. TBX</th>
                            <th>N¬∞ Container</th>
                            <th>Transportadora</th>
                            <th>Venc. Demurrage</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üìä</div>
                                    <p>Nenhum dado dispon√≠vel ainda.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ABA PLANEJADOR SEMANAL -->
        <div id="planejador" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #007acc;">üìÖ Planejador Semanal de Recebimento</h2>
            
            <!-- Navega√ß√£o de Semana -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="navegarSemana(-1)">‚¨ÖÔ∏è Semana Anterior</button>
                <h3 id="tituloSemana" style="color: #007acc;">Semana Atual</h3>
                <button class="btn btn-primary" onclick="navegarSemana(1)">Semana Seguinte ‚û°Ô∏è</button>
            </div>

            <!-- Filtro por Lote/PO -->
            <div class="form-section" style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end;">
                <div style="flex: 1; min-width: 260px;">
                    <label for="filtroLoteInput" style="margin-bottom: 6px; display: block;">Filtrar por lote/PO</label>
                    <input id="filtroLoteInput" type="text" class="search-box" placeholder="Ex: TBX-2025-001" oninput="filtrarPlanejadorPorLote(this.value)">
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-primary" style="background: #3e3e42; color: #cccccc;" onclick="document.getElementById('filtroLoteInput').value=''; filtrarPlanejadorPorLote('');">Limpar filtro</button>
                </div>
            </div>

            <!-- Importar Base de Previs√£o (s√≥ para logado) -->
            <div class="form-section" id="importPrevisaoSection" style="margin-bottom: 20px; display: none;">
                <h3 style="margin-bottom: 15px; color: #007acc;">üì• Importar Base de Previs√£o</h3>
                <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <input type="file" id="fileInputPrevisao" accept=".xlsx,.xls,.csv" onchange="importarPrevisao(event)" style="display: none;">
                    <button class="btn btn-import" onclick="document.getElementById('fileInputPrevisao').click()">üìÇ Importar Excel de Previs√£o</button>
                    <button class="btn btn-primary" onclick="abrirModalRegistro()">‚ûï Programa√ß√£o de Container</button>
                    <button class="btn" style="background: #3e3e42; cursor: help;" title="Formato esperado:&#10;‚Ä¢ Coluna A: N√∫mero da PO (Lote)&#10;‚Ä¢ Coluna D: Container&#10;‚Ä¢ Coluna E: Item/Produto&#10;‚Ä¢ Coluna F: Quantidade&#10;‚Ä¢ Coluna I: Previs√£o de Chegada (Data Embarque)">‚ÑπÔ∏è Formato</button>
                    <small style="color: #e74c3c;">‚ö†Ô∏è A importa√ß√£o substitui todos os dados anteriores</small>
                </div>
            </div>

            <!-- Resumo da Semana -->
            <div class="stats" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <h3 id="totalContainersSemana">0</h3>
                    <p>Containers Previstos</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3 id="totalItensSemana">0</h3>
                    <p>Total de Itens</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3 id="totalUnidadesSemana">0</h3>
                    <p>Total de Unidades</p>
                </div>
            </div>

            <!-- Calend√°rio Semanal -->
            <div id="calendarioSemanal">
                <!-- Dias da semana ser√£o gerados dinamicamente -->
            </div>

            <!-- Lista de Produtos Esperados -->
            <div class="table-container">
                <h3 style="margin-bottom: 15px;">üì¶ Produtos Esperados na Semana</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Produto/Item</th>
                            <th>Containers</th>
                            <th>Quantidade Total</th>
                            <th>Tipo</th>
                        </tr>
                    </thead>
                    <tbody id="produtosSemanaBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <div>
                                    <div style="font-size: 3em;">üì¶</div>
                                    <p>Nenhum produto previsto para esta semana.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal para Registro de Container -->
        <div id="modalRegistro" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto;">
            <div style="max-width: 800px; margin: 50px auto; background: #252526; border-radius: 15px; padding: 30px; border: 1px solid #3e3e42;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #007acc; margin: 0;">Programa√ß√£o de Container</h2>
                    <button onclick="fecharModalRegistro()" style="background: #ef5350; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 16px;">‚úñ Fechar</button>
                </div>

                <form id="containerForm" class="form-section" style="margin: 0;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="selectPO">Selecionar PO/Lote da Programa√ß√£o</label>
                            <select id="selectPO" onchange="carregarContainersPorPO()">
                                <option value="">Selecione uma PO</option>
                            </select>
                            <small style="color: #858585; margin-top: 5px; display: block;">Ou preencha manualmente abaixo</small>
                        </div>
                        <div class="form-group">
                            <label for="selectContainer">Selecionar Container da PO</label>
                            <select id="selectContainer" onchange="preencherDadosContainer()" disabled>
                                <option value="">Selecione um container</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="refTbx">Ref. TBX (Lote) *</label>
                            <input type="text" id="refTbx" required placeholder="Ex: TBX-2025-001">
                        </div>
                        <div class="form-group">
                            <label for="container">N¬∞ Container *</label>
                            <input type="text" id="container" required placeholder="Ex: ABCD1234567">
                        </div>
                        <div class="form-group">
                            <label for="vencimentoPorto">Vencimento Armazenagem PORTO *</label>
                            <input type="date" id="vencimentoPorto" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataLiberacao">Data da Libera√ß√£o Carregamento</label>
                            <input type="date" id="dataLiberacao">
                        </div>
                        <div class="form-group">
                            <label for="dataCarregamento">Data do Carregamento</label>
                            <input type="date" id="dataCarregamento">
                        </div>
                        <div class="form-group">
                            <label for="vencimentoDemurrage">Vencimento Demurrage *</label>
                            <input type="date" id="vencimentoDemurrage" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="entregaTbx">Entrega TBX (Data)</label>
                            <input type="date" id="entregaTbx">
                        </div>
                        <div class="form-group">
                            <label for="previsaoDescarregamento">Previs√£o de In√≠cio de Descarregamento (Hora)</label>
                            <input type="time" id="previsaoDescarregamento">
                        </div>
                        <div class="form-group">
                            <label for="transportadora">Transportadora</label>
                            <select id="transportadora">
                                <option value="">Selecione uma transportadora</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="frete">Frete (Porto x TBX)</label>
                            <input type="text" id="frete" placeholder="R$ 0,00" oninput="formatarCampoMoeda(this)">
                        </div>
                    </div>

                    <div style="margin-top: 25px; text-align: right;">
                        <button type="button" class="btn btn-primary" onclick="limparFormulario()" style="background: #999; margin-right: 10px;">Limpar</button>
                        <button type="submit" class="btn btn-primary">üíæ Salvar Container</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
                // --- LOGIN SIMPLES ---
                let usuarioLogado = false;
                function abrirModalLogin() {
                    document.getElementById('modalLogin').style.display = 'flex';
                    document.getElementById('loginUsuario').focus();
                }
                function fecharModalLogin() {
                    document.getElementById('modalLogin').style.display = 'none';
                    document.getElementById('formLogin').reset();
                    document.getElementById('loginErro').style.display = 'none';
                }
                document.getElementById('formLogin').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const usuario = document.getElementById('loginUsuario').value.trim();
                    const senha = document.getElementById('loginSenha').value;
                    if (usuario === 'wellinton' && senha === 'wellinton7842') {
                        usuarioLogado = true;
                        localStorage.setItem('usuarioLogado', '1');
                        fecharModalLogin();
                        atualizarPermissoes();
                    } else {
                        document.getElementById('loginErro').style.display = 'block';
                    }
                });
                function logout() {
                    usuarioLogado = false;
                    localStorage.removeItem('usuarioLogado');
                    atualizarPermissoes();
                    // Voltar para a aba planejador ao sair
                    openTab('planejador');
                }
                function atualizarPermissoes() {
                                // Exibir/ocultar importa√ß√£o de previs√£o no planejador semanal
                                var importPrevisaoSection = document.getElementById('importPrevisaoSection');
                                if (importPrevisaoSection) {
                                    importPrevisaoSection.style.display = usuarioLogado ? '' : 'none';
                                }
                    // Bot√µes de login/logout
                    var loginBtn = document.getElementById('loginBtn');
                    var logoutBtn = document.getElementById('logoutBtn');
                    if (usuarioLogado) {
                        if (loginBtn) loginBtn.style.display = 'none';
                        if (logoutBtn) logoutBtn.style.display = '';
                    } else {
                        if (loginBtn) loginBtn.style.display = '';
                        if (logoutBtn) logoutBtn.style.display = 'none';
                    }
                    // Tabs e conte√∫dos
                    const tabs = document.querySelectorAll('.tab');
                    tabs.forEach(tab => {
                        if (tab.textContent.includes('Cadastro') || tab.textContent.includes('Dashboard')) {
                            tab.style.display = usuarioLogado ? '' : 'none';
                        }
                    });
                    // Conte√∫dos das abas
                    document.getElementById('cadastro').style.display = usuarioLogado ? '' : 'none';
                    document.getElementById('dashboard').style.display = usuarioLogado ? '' : 'none';
                    // Ocultar se√ß√£o de importa√ß√£o/exporta√ß√£o de quem n√£o est√° logado
                    document.querySelectorAll('.import-section').forEach(sec => {
                        sec.style.display = usuarioLogado ? '' : 'none';
                    });
                    // Bot√µes de a√ß√£o restritos (exceto navega√ß√£o de semana)
                    const botoesRestritos = document.querySelectorAll('.btn-edit, .btn-delete, .btn-import, .btn-export, .btn-status, [onclick^="abrirModalRegistro"], [onclick^="limparTodosDados"], [onclick^="marcarTodosComoEntregue"]');
                    botoesRestritos.forEach(btn => {
                        if (btn.closest('#planejador') || btn.closest('#consulta')) {
                            btn.style.display = usuarioLogado ? '' : 'none';
                        }
                    });
                    // Formul√°rios restritos
                    const formsRestritos = document.querySelectorAll('#containerForm, #transportadoraForm, #parametroPalletForm');
                    formsRestritos.forEach(form => {
                        form.querySelectorAll('input, select, button').forEach(el => {
                            el.disabled = !usuarioLogado;
                        });
                    });
                }
                // Fechar modal login ao clicar fora
                document.getElementById('modalLogin').addEventListener('click', function(e) {
                    if (e.target === this) fecharModalLogin();
                });
                // Estado inicial
                window.addEventListener('DOMContentLoaded', function() {
                    usuarioLogado = localStorage.getItem('usuarioLogado') === '1';
                    atualizarPermissoes();
                });
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB-1btOCpD3n9f0cR00iJDN64tGlAbU4wc",
            authDomain: "gestao-containers.firebaseapp.com",
            projectId: "gestao-containers",
            storageBucket: "gestao-containers.firebasestorage.app",
            messagingSenderId: "248431468982",
            appId: "1:248431468982:web:ae62d3255200adb55c6117",
            measurementId: "G-88V7Q1FC8D"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Array para armazenar os registros
        let containers = [];
        let transportadoras = [];
        let editandoId = null;
        let filtroStatusAtual = 'pendente'; // Filtro padr√£o: pendente
        let anoSelecionado = 'todos'; // Ano padr√£o: todos
        let graficoMensal = null; // Vari√°vel para armazenar inst√¢ncia do gr√°fico
        let unsubscribeContainers = null;
        let unsubscribeTransportadoras = null;
        let unsubscribePrevisoes = null;
        let filtroLotePlanejador = '';
        
        // Pagina√ß√£o
        let paginaAtual = 1;
        const itensPorPagina = 20;

        // Carregar dados ao iniciar com atualiza√ß√£o em tempo real
        window.onload = function() {
            iniciarListenersTempoReal();
        };

        // Configurar listeners em tempo real
        function iniciarListenersTempoReal() {
            try {
                // Containers
                if (unsubscribeContainers) unsubscribeContainers();
                unsubscribeContainers = db.collection('containers').onSnapshot(snapshot => {
                    containers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    atualizarTabela();
                    atualizarDashboard();
                    atualizarPlanejador();
                });

                // Transportadoras
                if (unsubscribeTransportadoras) unsubscribeTransportadoras();
                unsubscribeTransportadoras = db.collection('transportadoras').onSnapshot(snapshot => {
                    transportadoras = snapshot.docs.map(doc => doc.data().nome).sort();
                    carregarTransportadoras();
                    atualizarTabelaTransportadoras();
                });

                // Previs√µes
                if (unsubscribePrevisoes) unsubscribePrevisoes();
                unsubscribePrevisoes = db.collection('previsoes').onSnapshot(snapshot => {
                    previsoes = snapshot.docs.map(doc => {
                        const data = doc.data();
                        if (!Array.isArray(data.itens)) data.itens = [];
                        return { id: doc.id, ...data };
                    });
                    atualizarPlanejador();
                });
            } catch (error) {
                console.error('Erro ao iniciar listeners em tempo real:', error);
                alert('‚ö†Ô∏è Erro ao conectar em tempo real com o servidor.');
            }
        }

        // Salvar container no Firebase
        async function salvarContainerFirebase(registro) {
            try {
                await db.collection('containers').doc(String(registro.id)).set(registro);
                return true;
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('‚ö†Ô∏è Erro ao salvar no servidor.');
                return false;
            }
        }
        async function excluirContainerFirebase(id) {
            try {
                await db.collection('containers').doc(String(id)).delete();
                return true;
            } catch (error) {
                console.error('Erro ao excluir:', error, id);
                alert('‚ö†Ô∏è Erro ao excluir do servidor.');
                return false;
            }
        }

        // Salvar transportadora no Firebase
        async function salvarTransportadoraFirebase(nome) {
            try {
                await db.collection('transportadoras').add({ nome: nome });
                return true;
            } catch (error) {
                console.error('Erro ao salvar transportadora:', error);
                alert('‚ö†Ô∏è Erro ao salvar transportadora.');
                return false;
            }
        }

        // Excluir transportadora do Firebase
        async function excluirTransportadoraFirebase(nome) {
            try {
                const snapshot = await db.collection('transportadoras').where('nome', '==', nome).get();
                const batch = db.batch();
                snapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
                return true;
            } catch (error) {
                console.error('Erro ao excluir transportadora:', error);
                alert('‚ö†Ô∏è Erro ao excluir transportadora.');
                return false;
            }
        }

        // Fun√ß√£o para alternar entre abas
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            // Ativar a aba correta pelo nome
            // Encontrar o bot√£o da aba correspondente
            tabs.forEach(tab => {
                if (tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(`openTab('${tabName}')`)) {
                    tab.classList.add('active');
                }
            });
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') {
                atualizarDashboard();
            } else if (tabName === 'cadastro') {
                atualizarTabelaTransportadoras();
            }
        }

        // Submeter formul√°rio de transportadora
        document.getElementById('transportadoraForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nome = document.getElementById('nomeTransportadora').value.trim().toUpperCase();
            
            if (transportadoras.includes(nome)) {
                alert('‚ö†Ô∏è Esta transportadora j√° est√° cadastrada!');
                return;
            }
            
            salvarTransportadoraFirebase(nome).then(success => {
                if (success) {
                    transportadoras.push(nome);
                    transportadoras.sort();
                    
                    document.getElementById('transportadoraForm').reset();
                    carregarTransportadoras();
                    atualizarTabelaTransportadoras();
                    
                    alert('‚úÖ Transportadora cadastrada com sucesso!');
                }
            });
        });

        // Carregar transportadoras no select
        function carregarTransportadoras() {
            const select = document.getElementById('transportadora');
            const valorAtual = select.value;
            
            select.innerHTML = '<option value="">Selecione uma transportadora</option>';
            
            transportadoras.forEach(transp => {
                const option = document.createElement('option');
                option.value = transp;
                option.textContent = transp;
                select.appendChild(option);
            });
            
            // Restaurar valor se ainda existir
            if (valorAtual && transportadoras.includes(valorAtual)) {
                select.value = valorAtual;
            }
        }

        // Atualizar tabela de transportadoras
        function atualizarTabelaTransportadoras() {
            const tbody = document.getElementById('transportadorasTableBody');
            
            if (transportadoras.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="2" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üöö</div>
                                <p>Nenhuma transportadora cadastrada. Adicione uma nova acima.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = transportadoras.map(transp => `
                <tr>
                    <td><strong>${transp}</strong></td>
                    <td>
                        <button class="btn btn-delete" onclick="excluirTransportadora('${transp.replace(/'/g, "\\'")}')">üóëÔ∏è Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Excluir transportadora
        function excluirTransportadora(nome) {
            if (confirm(`Tem certeza que deseja excluir a transportadora "${nome}"?`)) {
                excluirTransportadoraFirebase(nome).then(success => {
                    if (success) {
                        transportadoras = transportadoras.filter(t => t !== nome);
                        carregarTransportadoras();
                        atualizarTabelaTransportadoras();
                        alert('‚úÖ Transportadora exclu√≠da com sucesso!');
                    }
                });
            }
        }

        // Submeter formul√°rio
        document.getElementById('containerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const refTbx = document.getElementById('refTbx').value;
            const containerNum = document.getElementById('container').value;
            // Impedir programa√ß√£o duplicada
            if (!editandoId && containers.some(c => c.refTbx === refTbx && c.container === containerNum)) {
                alert('‚ö†Ô∏è Este lote e container j√° foram programados. Se deseja reprogramar, exclua primeiro na aba Consulta.');
                return;
            }
            const registro = {
                id: editandoId || Date.now(),
                refTbx: refTbx,
                container: containerNum,
                vencimentoPorto: document.getElementById('vencimentoPorto').value,
                dataLiberacao: document.getElementById('dataLiberacao').value,
                dataCarregamento: document.getElementById('dataCarregamento').value,
                vencimentoDemurrage: document.getElementById('vencimentoDemurrage').value,
                entregaTbx: document.getElementById('entregaTbx').value,
                previsaoDescarregamento: document.getElementById('previsaoDescarregamento').value,
                transportadora: document.getElementById('transportadora').value,
                frete: converterMoedaParaNumero(document.getElementById('frete').value),
                statusEntrega: editandoId ? containers.find(c => c.id === editandoId)?.statusEntrega || 'pendente' : 'pendente'
            };

            // Salvar no Firebase
            salvarContainerFirebase(registro).then(success => {
                if (success) {
                    if (editandoId) {
                        const index = containers.findIndex(c => c.id === editandoId);
                        containers[index] = registro;
                        editandoId = null;
                    } else {
                        containers.push(registro);
                    }
                    limparFormulario();
                    fecharModalRegistro();
                    atualizarTabela();
                    atualizarDashboard();
                    atualizarPlanejador();
                    alert('‚úÖ Container registrado com sucesso!');
                }
            });
        });

        // Limpar formul√°rio
        function limparFormulario() {
            document.getElementById('containerForm').reset();
            document.getElementById('selectPO').value = '';
            document.getElementById('selectContainer').value = '';
            document.getElementById('selectContainer').disabled = true;
            editandoId = null;
        }

        // Atualizar tabela de consulta
        function atualizarTabela() {
            const tbody = document.getElementById('tableBody');
            
            // Filtrar containers baseado no status atual
            let containersFiltrados = containers;
            if (filtroStatusAtual === 'pendente') {
                containersFiltrados = containers.filter(c => c.statusEntrega !== 'entregue');
            } else if (filtroStatusAtual === 'entregue') {
                containersFiltrados = containers.filter(c => c.statusEntrega === 'entregue');
            }

            // Ordena√ß√£o por data de entrega + previs√£o descarga
            const direcao = filtroStatusAtual === 'pendente' ? 'asc' : 'desc';
            const containersOrdenados = [...containersFiltrados].sort((a, b) => {
                const montarTimestamp = (reg) => {
                    if (reg.entregaTbx) {
                        const data = new Date(reg.entregaTbx).toISOString().split('T')[0];
                        const hora = reg.previsaoDescarregamento || '00:00';
                        return new Date(`${data}T${hora}`).getTime();
                    }
                    return direcao === 'desc' ? 0 : Number.POSITIVE_INFINITY; // sem entrega vai para o fim
                };

                const tsA = montarTimestamp(a);
                const tsB = montarTimestamp(b);

                return direcao === 'asc' ? tsA - tsB : tsB - tsA;
            });
            
            if (containersFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üì¶</div>
                                <p>Nenhum registro encontrado nesta categoria.</p>
                            </div>
                        </td>
                    </tr>
                `;
                document.getElementById('paginacao').innerHTML = '';
                return;
            }

            // Calcular pagina√ß√£o
            const totalPaginas = Math.ceil(containersOrdenados.length / itensPorPagina);
            const inicio = (paginaAtual - 1) * itensPorPagina;
            const fim = inicio + itensPorPagina;
            const containersPagina = containersOrdenados.slice(inicio, fim);

            tbody.innerHTML = containersPagina.map(c => {
                const isEntregue = c.statusEntrega === 'entregue';
                let acoes = '';
                if (usuarioLogado) {
                    acoes = `
                        <button class="btn btn-edit" onclick="editarContainer('${c.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-delete" onclick="excluirRegistro('${c.id}')">üóëÔ∏è Excluir</button>
                    `;
                }
                return `
                <tr>
                    <td>
                        ${isEntregue 
                            ? '<button class="btn btn-status entregue" disabled>‚úÖ Entregue</button>' 
                            : (usuarioLogado 
                                ? `<button class="btn btn-status" onclick="marcarComoEntregue('${c.id}')">Marcar Entregue</button>` 
                                : '<span class="status-badge status-pendente">‚è≥ Pendente</span>')
                        }
                    </td>
                    <td><strong>${c.refTbx}</strong></td>
                    <td>${c.container}</td>
                    <td>${formatarData(c.vencimentoPorto)}</td>
                    <td>${formatarData(c.dataLiberacao)}</td>
                    <td>${formatarData(c.dataCarregamento)}</td>
                    <td>${formatarData(c.vencimentoDemurrage)}</td>
                    <td>${formatarData(c.entregaTbx)}</td>
                    <td>${c.previsaoDescarregamento || '-'}</td>
                    <td>${c.transportadora || '-'}</td>
                    <td>${formatarMoeda(c.frete)}</td>
                    <td>${acoes}</td>
                </tr>
            `}).join('');
            
            // Atualizar pagina√ß√£o
            atualizarPaginacao(totalPaginas, containersFiltrados.length);
        }
        
        // Atualizar controles de pagina√ß√£o
        function atualizarPaginacao(totalPaginas, totalItens) {
            const paginacaoDiv = document.getElementById('paginacao');
            if (totalPaginas <= 1) {
                paginacaoDiv.innerHTML = '';
                return;
            }
            
            const inicio = (paginaAtual - 1) * itensPorPagina + 1;
            const fim = Math.min(paginaAtual * itensPorPagina, totalItens);
            
            let html = '<div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 20px;">';
            
            // Bot√£o anterior
            html += `<button class="btn btn-primary" onclick="mudarPagina(${paginaAtual - 1})" ${paginaAtual === 1 ? 'disabled' : ''}>‚óÄ Anterior</button>`;
            
            // Informa√ß√£o da p√°gina
            html += `<span style="color: #cccccc;">Mostrando ${inicio}-${fim} de ${totalItens} registros | P√°gina ${paginaAtual} de ${totalPaginas}</span>`;
            
            // Bot√£o pr√≥xima
            html += `<button class="btn btn-primary" onclick="mudarPagina(${paginaAtual + 1})" ${paginaAtual === totalPaginas ? 'disabled' : ''}>Pr√≥xima ‚ñ∂</button>`;
            
            html += '</div>';
            paginacaoDiv.innerHTML = html;
        }
        
        // Mudar de p√°gina
        function mudarPagina(novaPagina) {
            paginaAtual = novaPagina;
            atualizarTabela();
        }

        // Excluir registro
        function excluirRegistro(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                excluirContainerFirebase(id).then(success => {
                    if (success) {
                        containers = containers.filter(c => String(c.id) !== String(id));
                        atualizarTabela();
                        atualizarDashboard();
                        atualizarPlanejador();
                        alert('‚úÖ Registro exclu√≠do com sucesso!');
                    }
                });
            }
        }

        // Filtrar tabela
        function filtrarTabela() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const tbody = document.getElementById('tableBody');
            const rows = tbody.getElementsByTagName('tr');

            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            }
        }

        // Data de refer√™ncia √∫nica para filtros/agrupamentos (prioriza entrega real)
        function obterDataReferencia(container) {
            return container.entregaTbx
                || container.dataCarregamento
                || container.vencimentoDemurrage
                || container.vencimentoPorto
                || null;
        }

        // Filtrar por status
        function filtrarPorStatus(status) {
            filtroStatusAtual = status;
            paginaAtual = 1; // Resetar para p√°gina 1 ao mudar filtro
            
            // Atualizar sub-tabs visuais
            const subTabs = document.querySelectorAll('.sub-tab');
            subTabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            atualizarTabela();
        }

        // Marcar container como entregue
        function marcarComoEntregue(id) {
            if (confirm('Marcar este container como entregue?')) {
                const container = containers.find(c => String(c.id) === String(id));
                if (container) {
                    container.statusEntrega = 'entregue';
                    
                    salvarContainerFirebase(container).then(success => {
                        if (success) {
                            atualizarTabela();
                            atualizarDashboard();
                            atualizarPlanejador();
                            alert('‚úÖ Container marcado como entregue!');
                        }
                    });
                } else {
                    console.error('Container n√£o encontrado. ID:', id);
                    alert('‚ùå Erro: Container n√£o encontrado.');
                }
            }
        }

        // Marcar todos os containers como entregue
        function marcarTodosComoEntregue() {
            const pendentes = containers.filter(c => c.statusEntrega !== 'entregue');
            
            if (pendentes.length === 0) {
                alert('‚ÑπÔ∏è N√£o h√° containers pendentes para marcar como entregue.');
                return;
            }
            
            if (confirm(`Marcar ${pendentes.length} container(s) pendente(s) como entregue?`)) {
                const promises = containers.map(c => {
                    c.statusEntrega = 'entregue';
                    return salvarContainerFirebase(c);
                });
                
                Promise.all(promises).then(() => {
                    atualizarTabela();
                    atualizarDashboard();
                    alert(`‚úÖ ${pendentes.length} container(s) marcado(s) como entregue!`);
                });
            }
        }


        // Atualizar dashboard
        function atualizarDashboard() {
            // Popular filtros de anos (ambos os selects)
            popularFiltroAnos();

            // Obter ano selecionado do filtro principal do dashboard
            const selectAnoDashboard = document.getElementById('filtroAnoDashboard');
            anoSelecionado = selectAnoDashboard ? selectAnoDashboard.value : 'todos';

            // Filtrar containers por ano
            let containersFiltradosPorAno = containers;
            if (anoSelecionado !== 'todos') {
                containersFiltradosPorAno = containers.filter(c => {
                    const dataRef = obterDataReferencia(c);
                    if (dataRef) {
                        const ano = new Date(dataRef).getFullYear();
                        return ano.toString() === anoSelecionado;
                    }
                    return false;
                });
            }

            // Calcular m√©tricas com base nos containers filtrados por ano
            document.getElementById('totalContainers').textContent = containersFiltradosPorAno.length;

            // Calcular total de frete - do ano selecionado
            const totalFrete = containersFiltradosPorAno.reduce((sum, c) => sum + (parseFloat(c.frete) || 0), 0);
            document.getElementById('totalFrete').textContent = formatarMoeda(totalFrete);

            // Atualizar tabela de frete por transportadora - com filtro de ano
            atualizarFreteTransportadora(containersFiltradosPorAno);

            // Atualizar gr√°fico mensal
            atualizarGraficoMensal(containersFiltradosPorAno);

            // Atualizar tabela do dashboard - apenas pendentes do ano selecionado
            const containersPendentesFiltrados = containersFiltradosPorAno.filter(c => c.statusEntrega !== 'entregue');
            const dashboardBody = document.getElementById('dashboardTableBody');
            if (containersPendentesFiltrados.length === 0) {
                dashboardBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üìä</div>
                                <p>Nenhum container pendente no per√≠odo selecionado.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            const containeresRecentes = [...containersPendentesFiltrados].reverse().slice(0, 5);
            dashboardBody.innerHTML = containeresRecentes.map(c => {
                const status = calcularStatus(c.vencimentoDemurrage);
                return `
                    <tr>
                        <td><strong>${c.refTbx}</strong></td>
                        <td>${c.container}</td>
                        <td>${c.transportadora || '-'}</td>
                        <td>${formatarData(c.vencimentoDemurrage)}</td>
                        <td><span class="status-badge ${status.classe}">${status.texto}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Popular filtro de anos
        function popularFiltroAnos() {
            const selectAnoDashboard = document.getElementById('filtroAnoDashboard');
            if (!selectAnoDashboard) return;

            const anoAtual = selectAnoDashboard.value; // Preservar sele√ß√£o atual
            const anos = new Set();

            containers.forEach(c => {
                const dataRef = obterDataReferencia(c);
                if (dataRef) {
                    const ano = new Date(dataRef).getFullYear();
                    anos.add(ano);
                }
            });

            const anosOrdenados = Array.from(anos).sort((a, b) => b - a);
            
            let options = '<option value="todos">Todos os Anos</option>';
            anosOrdenados.forEach(ano => {
                options += `<option value="${ano}">${ano}</option>`;
            });

            selectAnoDashboard.innerHTML = options;
            
            // Restaurar sele√ß√£o se ainda existir
            if (anoAtual && (anoAtual === 'todos' || anosOrdenados.includes(parseInt(anoAtual)))) {
                selectAnoDashboard.value = anoAtual;
            }
        }

        // Atualizar tabela de frete por transportadora
        function atualizarFreteTransportadora(todosContainers) {
            const freteBody = document.getElementById('freteTransportadoraBody');
            
            if (todosContainers.length === 0) {
                freteBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üöö</div>
                                <p>Nenhum container cadastrado no momento.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Agrupar por transportadora
            const transportadoras = {};
            todosContainers.forEach(c => {
                const transp = c.transportadora || 'Sem Transportadora';
                if (!transportadoras[transp]) {
                    transportadoras[transp] = {
                        quantidade: 0,
                        totalFrete: 0
                    };
                }
                transportadoras[transp].quantidade++;
                transportadoras[transp].totalFrete += parseFloat(c.frete) || 0;
            });

            // Ordenar por total de frete (maior para menor)
            const transportadorasOrdenadas = Object.entries(transportadoras)
                .sort((a, b) => b[1].totalFrete - a[1].totalFrete);

            freteBody.innerHTML = transportadorasOrdenadas.map(([nome, dados]) => `
                <tr>
                    <td><strong>${nome}</strong></td>
                    <td>${dados.quantidade}</td>
                    <td><strong style="color: #007acc;">${formatarMoeda(dados.totalFrete)}</strong></td>
                </tr>
            `).join('');
        }

        // Atualizar gr√°fico mensal
        function atualizarGraficoMensal(containersFiltrados) {
            const ctx = document.getElementById('graficoMensal');
            if (!ctx) return;

            // Destruir gr√°fico anterior se existir
            if (graficoMensal) {
                graficoMensal.destroy();
            }

            // Agrupar dados por m√™s
            const dadosPorMes = {};
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            
            // Inicializar todos os meses
            meses.forEach((mes, index) => {
                dadosPorMes[index] = {
                    quantidade: 0,
                    valorTotal: 0
                };
            });

            // Preencher com dados reais
            containersFiltrados.forEach(c => {
                const dataRef = obterDataReferencia(c);
                if (dataRef) {
                    const data = new Date(dataRef);
                    const mes = data.getMonth();
                    dadosPorMes[mes].quantidade++;
                    dadosPorMes[mes].valorTotal += parseFloat(c.frete) || 0;
                }
            });

            // Preparar dados para o gr√°fico
            const labels = meses;
            const quantidades = meses.map((_, index) => dadosPorMes[index].quantidade);
            const valores = meses.map((_, index) => dadosPorMes[index].valorTotal);

            // M√©dias acumuladas apenas com meses do ano selecionado que j√° t√™m dados
            const linhaMedia = [];
            const linhaMediaValor = [];
            let somaQuantAcumulada = 0;
            let somaValorAcumulado = 0;
            let mesesComDados = 0;

            for (let i = 0; i < 12; i++) {
                const temDadoMes = quantidades[i] > 0 || valores[i] > 0;
                if (temDadoMes) {
                    mesesComDados++;
                    somaQuantAcumulada += quantidades[i];
                    somaValorAcumulado += valores[i];
                }
                const divisor = mesesComDados || 1;
                linhaMedia.push(mesesComDados ? somaQuantAcumulada / divisor : 0);
                linhaMediaValor.push(mesesComDados ? somaValorAcumulado / divisor : 0);
            }

            // Criar gr√°fico
            graficoMensal = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Quantidade de Containers',
                            data: quantidades,
                            backgroundColor: 'rgba(0, 122, 204, 0.7)',
                            borderColor: '#007acc',
                            borderWidth: 2,
                            yAxisID: 'y',
                            order: 3
                        },
                        {
                            label: 'Valor Total (R$)',
                            data: valores,
                            backgroundColor: 'rgba(79, 172, 254, 0.5)',
                            borderColor: '#4facfe',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            order: 4
                        },
                        {
                            label: 'M√©dia de Quantidade',
                            data: linhaMedia,
                            type: 'line',
                            borderColor: '#f093fb',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            yAxisID: 'y',
                            order: 1
                        },
                        {
                            label: 'M√©dia de Valor',
                            data: linhaMediaValor,
                            type: 'line',
                            borderColor: '#00f2fe',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            borderDash: [10, 5],
                            pointRadius: 0,
                            yAxisID: 'y1',
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#cccccc',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#252526',
                            titleColor: '#007acc',
                            bodyColor: '#cccccc',
                            borderColor: '#3e3e42',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.yAxisID === 'y1') {
                                        label += formatarMoeda(context.parsed.y);
                                    } else {
                                        label += context.parsed.y.toFixed(2);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#3e3e42'
                            },
                            ticks: {
                                color: '#cccccc'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Quantidade',
                                color: '#007acc'
                            },
                            grid: {
                                color: '#3e3e42'
                            },
                            ticks: {
                                color: '#cccccc'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Valor (R$)',
                                color: '#4facfe'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                color: '#cccccc',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 0, maximumFractionDigits: 0});
                                }
                            }
                        }
                    }
                }
            });
        }

        // Calcular status baseado no vencimento
        function calcularStatus(vencimento) {
            if (!vencimento) return { texto: 'Pendente', classe: 'status-pendente' };
            
            const hoje = new Date();
            const dataVenc = new Date(vencimento);
            const diffDias = Math.floor((dataVenc - hoje) / (1000 * 60 * 60 * 24));

            if (diffDias < 0) {
                return { texto: 'Atrasado', classe: 'status-atrasado' };
            } else if (diffDias <= 7) {
                return { texto: 'Pr√≥ximo', classe: 'status-pendente' };
            } else {
                return { texto: 'No Prazo', classe: 'status-concluido' };
            }
        }

        // Formatar data
        function formatarData(data) {
            if (!data) return '-';
            const d = new Date(data + 'T00:00:00');
            return d.toLocaleDateString('pt-BR');
        }

        // Formatar moeda
        function formatarMoeda(valor) {
            if (!valor) return 'R$ 0,00';
            return 'R$ ' + parseFloat(valor).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Formatar campo de moeda enquanto digita
        function formatarCampoMoeda(input) {
            let value = input.value.replace(/\D/g, '');
            if (value === '') {
                input.value = '';
                return;
            }
            value = (parseInt(value) / 100).toFixed(2);
            input.value = 'R$ ' + parseFloat(value).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Converter moeda formatada para n√∫mero
        function converterMoedaParaNumero(valorFormatado) {
            if (!valorFormatado) return '';
            return valorFormatado.replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
        }

        // Importar arquivo Excel/CSV
        function importarArquivo(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    // Pular a linha de cabe√ßalho
                    const rows = jsonData.slice(1);
                    let importados = 0;
                    const promises = [];

                    rows.forEach(row => {
                        if (!row[0]) return; // Pular linhas vazias

                        const registro = {
                            id: Date.now() + Math.random(),
                            refTbx: row[0] || '',
                            container: row[1] || '',
                            vencimentoPorto: converterDataExcel(row[2]),
                            vencimentoDemurrage: converterDataExcel(row[3]),
                            dataLiberacao: converterDataExcel(row[4]),
                            dataCarregamento: converterDataExcel(row[5]),
                            entregaTbx: converterDataExcel(row[8]),
                            previsaoDescarregamento: extrairHora(row[9]), // Coluna J (Status com texto e hora) - √≠ndice 9
                            transportadora: row[10] || '', // Coluna K (Transportadora) - √≠ndice 10
                            frete: extrairValor(row[11]), // Coluna L (Frete) - √≠ndice 11
                            statusEntrega: 'entregue' // Dados importados s√£o marcados como entregues
                        };

                        containers.push(registro);
                        promises.push(salvarContainerFirebase(registro));
                        importados++;
                    });

                    Promise.all(promises).then(() => {
                        atualizarTabela();
                        atualizarDashboard();
                        
                        alert(`‚úÖ ${importados} registro(s) importado(s) com sucesso!`);
                        event.target.value = ''; // Limpar input
                    });
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    alert('‚ùå Erro ao importar arquivo. Verifique o formato e tente novamente.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Converter data do Excel para formato ISO
        function converterDataExcel(valor) {
            if (!valor) return '';
            
            // Se for n√∫mero (data do Excel)
            if (typeof valor === 'number') {
                const date = XLSX.SSF.parse_date_code(valor);
                return `${date.y}-${String(date.m).padStart(2, '0')}-${String(date.d).padStart(2, '0')}`;
            }
            
            // Se for string no formato DD/MM/YYYY
            if (typeof valor === 'string' && valor.includes('/')) {
                const parts = valor.split('/');
                if (parts.length === 3) {
                    return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
                }
            }
            
            return '';
        }

        // Extrair hora do texto
        function extrairHora(texto) {
            if (!texto) return '';
            const match = String(texto).match(/(\d{1,2}):(\d{2})/);
            return match ? `${match[1].padStart(2, '0')}:${match[2]}` : '';
        }

        // Converter hora do Excel (n√∫mero decimal) para HH:MM
        function converterHoraExcel(valor) {
            if (!valor) return '';
            
            // Se for n√∫mero (hora do Excel como fra√ß√£o do dia)
            if (typeof valor === 'number') {
                // Horas no Excel s√£o armazenadas como fra√ß√£o de 24h
                const totalMinutos = Math.round(valor * 24 * 60);
                const horas = Math.floor(totalMinutos / 60);
                const minutos = totalMinutos % 60;
                return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}`;
            }
            
            // Se for string no formato HH:MM
            if (typeof valor === 'string') {
                const match = valor.match(/(\d{1,2}):(\d{2})/);
                return match ? `${match[1].padStart(2, '0')}:${match[2]}` : '';
            }
            
            return '';
        }

        // Extrair valor num√©rico
        function extrairValor(texto) {
            if (!texto) return '';
            
            // Se for n√∫mero direto do Excel
            if (typeof texto === 'number') {
                return texto.toString();
            }
            
            // Se for string com R$
            if (typeof texto === 'string') {
                const match = texto.match(/R\$\s*([\d.,]+)/);
                if (match) {
                    return match[1].replace(/\./g, '').replace(',', '.');
                }
                // Se for string com n√∫mero
                return texto.replace(/\./g, '').replace(',', '.');
            }
            
            return '';
        }

        // Exportar para Excel
        function exportarParaExcel() {
            if (containers.length === 0) {
                alert('N√£o h√° dados para exportar.');
                return;
            }

            const dados = containers.map(c => ({
                'Ref. TBX': c.refTbx,
                'Containers': c.container,
                'Vencimento armazenagem PORTO': formatarData(c.vencimentoPorto),
                'Vencimento demurrage': formatarData(c.vencimentoDemurrage),
                'Data da libera√ß√£o carregamento': formatarData(c.dataLiberacao),
                'Data carregamento': formatarData(c.dataCarregamento),
                'Entrega TBX': formatarData(c.entregaTbx),
                'Previs√£o in√≠cio descarregamento': c.previsaoDescarregamento || '',
                'Transportadora': c.transportadora || '',
                'Frete (R$)': c.frete || ''
            }));

            const ws = XLSX.utils.json_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Containers');
            
            const fileName = `containers_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // Limpar todos os dados
        function limparTodosDados() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° apagar TODOS os registros salvos. Deseja continuar?')) {
                if (confirm('Tem certeza? Esta a√ß√£o n√£o pode ser desfeita!')) {
                    containers = [];
                    localStorage.setItem('containers', JSON.stringify(containers));
                    atualizarTabela();
                    atualizarDashboard();
                    alert('‚úÖ Todos os dados foram removidos com sucesso!');
                }
            }
        }

        // ========== PLANEJADOR SEMANAL ==========
        let previsoes = []; // Array para armazenar previs√µes de chegada
        let semanaAtual = 0; // Offset da semana atual (0 = semana atual, 1 = pr√≥xima, -1 = anterior)

        function filtrarPlanejadorPorLote(valor) {
            filtroLotePlanejador = (valor || '').trim().toLowerCase();
            atualizarPlanejador();
        }

        function obterPrevisoesFiltradas() {
            if (!filtroLotePlanejador) return previsoes;
            return previsoes.filter(p => (p.po || '').toLowerCase().includes(filtroLotePlanejador));
        }

        // Carregar previs√µes do Firebase
        async function carregarPrevisoesFirebase() {
            try {
                const snapshot = await db.collection('previsoes').get();
                previsoes = [];
                snapshot.forEach(doc => {
                    const data = doc.data();

                    // Garantir que itens seja um array
                    if (!Array.isArray(data.itens)) {
                        data.itens = [];
                    }
                    previsoes.push({ id: doc.id, ...data });
                });
                console.log('Previs√µes carregadas:', previsoes); // Debug
                atualizarPlanejador();
            } catch (error) {
                console.error('Erro ao carregar previs√µes:', error);
            }
        }

        // Salvar previs√£o no Firebase
        async function salvarPrevisaoFirebase(previsao) {
            try {
                await db.collection('previsoes').doc(String(previsao.id)).set(previsao);
                return true;
           
                                 
                      
            } catch (error) {
                console.error('Erro ao salvar previs√£o:', error);
                alert('‚ùå Erro ao salvar no Firebase. Tente novamente.');
                return false;
            }
        }

        // Excluir previs√£o do Firebase
        async function excluirPrevisaoFirebase(id) {
            try {
                await db.collection('previsoes').doc(String(id)).delete();
                return true;
            } catch (error) {
                console.error('Erro ao excluir previs√£o:', error);
                alert('‚ùå Erro ao excluir do Firebase.');
                return false;
            }
        }

        // Limpar containers duplicados (com / e sem itens)
        async function limparDuplicadosFirebase() {
            if (!confirm('Deseja remover containers duplicados sem itens do banco de dados?')) {
                return;
            }
            
            try {
                const snapshot = await db.collection('previsoes').get();
                let removidos = 0;
                const promises = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Remove se: tem "/" no container E n√£o tem itens (ou array vazio)
                    if (data.container && data.container.includes('/')) {
                        if (!data.itens || !Array.isArray(data.itens) || data.itens.length === 0) {
                            console.log('Removendo duplicado:', data.container, doc.id);
                            promises.push(db.collection('previsoes').doc(doc.id).delete());
                            removidos++;
                        }
                    }
                });
                
                await Promise.all(promises);
                alert(`‚úÖ ${removidos} container(s) duplicado(s) removido(s)!`);
                await carregarPrevisoesFirebase();
            } catch (error) {
                console.error('Erro ao limpar duplicados:', error);
                alert('‚ùå Erro ao limpar duplicados.');
            }
        }

        // Importar arquivo de previs√£o
        function importarPrevisao(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    const rows = jsonData.slice(1);
                    
                    // Agrupar produtos por container
                    const containersAgrupados = {};
                    
                    rows.forEach(row => {
                        if (!row[0]) return;

                        // Sempre pegar os 11 primeiros d√≠gitos do n√∫mero do container, ignorando qualquer coisa ap√≥s barra ou espa√ßo
                        let containerNumero = String(row[3] || '').replace(/\s/g, '');
                        // Se houver barra, pega s√≥ o que est√° antes
                        if (containerNumero.includes('/')) {
                            containerNumero = containerNumero.split('/')[0];
                        }
                        // Garante que s√≥ os 11 primeiros caracteres (n√∫mero do container)
                        containerNumero = containerNumero.substring(0, 11).toUpperCase();

                        const chave = `${row[0]}_${containerNumero}`; // PO + Container como chave √∫nica

                        if (!containersAgrupados[chave]) {
                            containersAgrupados[chave] = {
                                id: Date.now() + Math.random(),
                                po: String(row[0] || ''),
                                fornecedor: String(row[1] || ''),
                                blNr: String(row[2] || ''),
                                container: containerNumero,
                                itens: [],
                                dataEmbarque: converterDataExcel(row[8]),
                                status: 'aguardando',
                                dataDescarregamento: '',
                                horaDescarregamento: '',
                                observacoes: ''
                            };
                        }

                        // Adicionar item √† lista de itens do container
                        if (row[4]) { // S√≥ adiciona se tiver item
                            containersAgrupados[chave].itens.push({
                                item: String(row[4] || ''),
                                quantidade: Number(row[5]) || 0,
                                tipo: String(row[6] || '')
                            });
                        }
                    });

                    // **LIMPAR TODOS OS DADOS ANTIGOS DO FIREBASE**
                    console.log('Removendo dados antigos do Firebase...');
                    const snapshotAntigo = await db.collection('previsoes').get();
                    const deletePromises = [];
                    snapshotAntigo.forEach(doc => {
                        deletePromises.push(db.collection('previsoes').doc(doc.id).delete());
                    });
                    await Promise.all(deletePromises);
                    console.log(`${deletePromises.length} registro(s) antigo(s) removido(s)`);

                    // Limpar array local
                    previsoes = [];

                    // Salvar containers agrupados
                    const promises = [];
                    const containersArray = Object.values(containersAgrupados);
                    
                    console.log('Containers agrupados:', containersArray); // Debug
                    
                    containersArray.forEach(container => {
                        previsoes.push(container);
                        promises.push(salvarPrevisaoFirebase(container));
                    });

                    await Promise.all(promises);
                    atualizarPlanejador();
                    alert(`‚úÖ ${containersArray.length} container(s) importado(s) com ${containersArray.reduce((acc, c) => acc + c.itens.length, 0)} itens!\n(Dados anteriores foram removidos)`);
                    event.target.value = '';
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    alert('‚ùå Erro ao importar arquivo. Verifique o formato e tente novamente.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Obter intervalo de datas da semana
        function obterIntervaloSemana(offset) {
            const hoje = new Date();
            const primeiroDia = new Date(hoje);
            primeiroDia.setDate(hoje.getDate() - hoje.getDay() + (offset * 7)); // Domingo da semana
            
            const dias = [];
            for (let i = 0; i < 7; i++) {
                const dia = new Date(primeiroDia);
                dia.setDate(primeiroDia.getDate() + i);
                dias.push(dia);
            }
            return dias;
        }

        // Formatar data para exibi√ß√£o
        function formatarDataExibicao(data) {
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            return `${dia}/${mes}`;
        }

        // Obter nome do dia da semana
        function obterNomeDia(data) {
            const dias = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            return dias[data.getDay()];
        }

        // Verificar se √© hoje
        function ehHoje(data) {
            const hoje = new Date();
            return data.toDateString() === hoje.toDateString();
        }

        // Atualizar planejador semanal
        function atualizarPlanejador() {
            const previsoesConsideradas = obterPrevisoesFiltradas();
            const diasSemana = obterIntervaloSemana(semanaAtual);
            // Atualizar t√≠tulo
            const primeiraData = formatarDataExibicao(diasSemana[0]);
            const ultimaData = formatarDataExibicao(diasSemana[6]);
            document.getElementById('tituloSemana').textContent = 
                `Semana de ${primeiraData} a ${ultimaData}`;

            // Inicializar totais
            let containersUnicosSemana = new Set();
            let totalItens = new Set();
            let totalUnidades = 0;

            // Gerar calend√°rio
            const calendarioDiv = document.getElementById('calendarioSemanal');
            calendarioDiv.innerHTML = '';

            // Fun√ß√£o para criar card do dia
            function criarCardDia(dia) {
                const diaStr = dia.toISOString().split('T')[0];
                const previsoesNoDia = previsoesConsideradas.filter(p => p.dataEmbarque === diaStr);
                const diaCard = document.createElement('div');
                // Adicionar classes para sabado/domingo
                const diaSemana = dia.getDay();
                let extraClass = '';
                if (diaSemana === 0) extraClass = 'domingo';
                if (diaSemana === 6) extraClass = 'sabado';
                diaCard.className = `dia-card ${ehHoje(dia) ? 'hoje' : ''} ${extraClass}`;

                let containersDoDia = new Set();
                previsoesNoDia.forEach(p => {
                    containersDoDia.add(p.container);
                    containersUnicosSemana.add(p.container);
                    // Contar itens agrupados
                    if (p.itens && Array.isArray(p.itens)) {
                        p.itens.forEach(item => {
                            totalItens.add(item.item);
                            totalUnidades += Number(item.quantidade) || 0;
                        });
                    }
                });

                // Adicionar c√°lculo de pallets por item
                function getPalletsForItem(codigo, quantidade) {
                    const param = parametrosPallet.find(p => p.codigo === codigo);
                    if (param && param.quantidade > 0) {
                        return Math.ceil(Number(quantidade) / param.quantidade);
                    }
                    return null;
                }

                // Calcular total de pallets do dia
                let totalPalletsDia = 0;
                previsoesNoDia.forEach(p => {
                    if (p.itens && Array.isArray(p.itens)) {
                        p.itens.forEach(item => {
                            const pallets = getPalletsForItem(item.item, item.quantidade);
                            if (pallets !== null) totalPalletsDia += pallets;
                        });
                    }
                });

                const previsoesOrdenadas = [...previsoesNoDia].sort((a, b) => {
                    const loteA = (a.po || '').toString();
                    const loteB = (b.po || '').toString();
                    // Ordena√ß√£o alfanum√©rica com n√∫meros naturais
                    return loteA.localeCompare(loteB, undefined, { numeric: true, sensitivity: 'base' });
                });

                diaCard.innerHTML = `
                    <div class="dia-card-header">
                        <h4>${obterNomeDia(dia)}</h4>
                        <div class="data">${formatarDataExibicao(dia)}</div>
                        <div style="display: flex; align-items: center; gap: 8px; color: #858585; font-size: 13px; flex-wrap: nowrap; white-space: nowrap;">
                            <span>${containersDoDia.size} container(s)</span>
                            ${totalPalletsDia > 0 ? `<span style='color:#4fc3f7;' title='Total de pallets do dia'>- ${totalPalletsDia} pallet${totalPalletsDia > 1 ? 's' : ''}</span>` : ''}
                        </div>
                    </div>
                    <div class="dia-card-body">
                        ${previsoesOrdenadas.length === 0 
                            ? '<p style="text-align: center; color: #858585; padding: 20px;">Nenhum container previsto</p>'
                            : previsoesOrdenadas.map(p => {
                                let itensHTML = '';
                                if (p.itens && Array.isArray(p.itens) && p.itens.length > 0) {
                                    itensHTML = p.itens.map(item => {
                                        const pallets = getPalletsForItem(item.item, item.quantidade);
                                        return `
                                            <div style=\"display:flex; align-items:center; margin-left: 10px; font-size: 11px; gap: 8px; flex-wrap:nowrap; white-space:nowrap;\">
                                                <span class=\"produto\">${item.item}</span>
                                                <span class=\"quantidade\" style=\"margin-left: 10px; display:flex; align-items:center; gap:6px; white-space:nowrap;\">
                                                    ${item.quantidade} ${item.tipo}
                                                    ${pallets !== null ? `<span style='color:#4fc3f7;' title='Qtd. de pallets necess√°ria'>(${pallets} pallet${pallets > 1 ? 's' : ''})</span>` : ''}
                                                </span>
                                            </div>
                                        `;
                                    }).join('');
                                } else {
                                    itensHTML = '<div class="produto" style="color: #858585;">Sem itens</div>';
                                }
                                const lote = p.po ? `Lote ${p.po}` : 'Lote n√£o informado';
                                return `
                                    <div class="container-item">
                                        <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                                            <strong>${p.container}</strong>
                                            <span style="color:#4fc3f7; font-size:11px;">${lote}</span>
                                        </div>
                                        ${itensHTML}
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                `;
                return diaCard;
            }

            // Renderizar todos os dias na ordem original
            diasSemana.forEach(dia => {
                calendarioDiv.appendChild(criarCardDia(dia));
            });

            // Atualizar totais
            document.getElementById('totalContainersSemana').textContent = containersUnicosSemana.size;
            document.getElementById('totalItensSemana').textContent = totalItens.size;
            document.getElementById('totalUnidadesSemana').textContent = totalUnidades.toLocaleString('pt-BR');

            // Atualizar tabela de produtos
            atualizarTabelaProdutos(diasSemana, previsoesConsideradas);
        }
        
        // Navegar entre semanas
        function navegarSemana(direcao) {
            semanaAtual += direcao;
            atualizarPlanejador();
        }

        // Atualizar tabela de produtos esperados
        function atualizarTabelaProdutos(diasSemana, previsoesFonte = previsoes) {
            const tbody = document.getElementById('produtosSemanaBody');
            
            const inicio = diasSemana[0].toISOString().split('T')[0];
            const fim = diasSemana[6].toISOString().split('T')[0];
            
            const previsoesSemana = previsoesFonte.filter(p => p.dataEmbarque >= inicio && p.dataEmbarque <= fim);
            
            if (previsoesSemana.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üì¶</div>
                                <p>Nenhum produto previsto para esta semana.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Agrupar por produto considerando itens dentro dos containers
            const produtosAgrupados = {};
            previsoesSemana.forEach(p => {
                if (p.itens && Array.isArray(p.itens)) {
                    p.itens.forEach(item => {
                        if (!produtosAgrupados[item.item]) {
                            produtosAgrupados[item.item] = {
                                containers: new Set(),
                                quantidade: 0,
                                tipo: item.tipo
                            };
                        }
                        produtosAgrupados[item.item].containers.add(p.container);
                        produtosAgrupados[item.item].quantidade += Number(item.quantidade) || 0;
                    });
                }
            });

            tbody.innerHTML = Object.keys(produtosAgrupados)
                .sort()
                .map(item => {
                    const dados = produtosAgrupados[item];
                    // C√°lculo de pallets
                    const param = parametrosPallet.find(p => p.codigo === item);
                    let pallets = null;
                    if (param && param.quantidade > 0) {
                        pallets = Math.ceil(Number(dados.quantidade) / param.quantidade);
                    }
                    return `
                        <tr>
                            <td>${item}</td>
                            <td>${dados.containers.size} container(s)</td>
                            <td><strong style="color: #4fc3f7;">${dados.quantidade.toLocaleString('pt-BR')}</strong>
                                ${pallets !== null ? `<span style='color:#4fc3f7; margin-left:8px;' title='Qtd. de pallets necess√°ria'>(${pallets} pallet${pallets > 1 ? 's' : ''})</span>` : ''}
                            </td>
                            <td>${dados.tipo}</td>
                        </tr>
                    `;
                }).join('');
        }

        // Atualizar timeline de descarregamento (agora mostra todos os containers registrados)
        function atualizarTimeline(diasSemana) {
            const tbody = document.getElementById('timelineBody');
            
            // Se o elemento n√£o existe (foi removido), n√£o faz nada
            if (!tbody) return;
            
            // Mostrar todos os containers, n√£o apenas da semana
            const todosContainers = containers;
            
            if (todosContainers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <div>
                                <div style="font-size: 3em;">üì¶</div>
                                <p>Nenhum container registrado.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Ordenar por data de vencimento demurrage
            const containersOrdenados = [...todosContainers].sort((a, b) => {
                if (!a.vencimentoDemurrage) return 1;
                if (!b.vencimentoDemurrage) return -1;
                return new Date(a.vencimentoDemurrage) - new Date(b.vencimentoDemurrage);
            });

            tbody.innerHTML = containersOrdenados
                .map(c => {
                    const statusClass = 
                        c.statusEntrega === 'entregue' ? 'status-concluido' : 'status-aguardando';
                    const statusTexto = c.statusEntrega === 'entregue' ? 'Entregue' : 'Pendente';
                    
                    // Buscar dados de previs√£o se existir
                    const previsao = previsoes.find(p => p.container === c.container);
                    const po = previsao ? previsao.po : '-';
                    const fornecedor = previsao ? previsao.fornecedor : '-';
                    const previsaoChegada = previsao && previsao.dataEmbarque 
                        ? new Date(previsao.dataEmbarque + 'T00:00:00').toLocaleDateString('pt-BR') 
                        : '-';
                    
                    return `
                        <tr>
                            <td><strong>${c.container}</strong></td>
                            <td>${c.refTbx}</td>
                            <td>${po}</td>
                            <td>${fornecedor}</td>
                            <td>${previsaoChegada}</td>
                            <td>${c.vencimentoDemurrage ? new Date(c.vencimentoDemurrage + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</td>
                            <td>${c.transportadora || '-'}</td>
                            <td>${c.frete ? formatarMoeda(c.frete) : '-'}</td>
                            <td>
                                <span class="status-badge ${statusClass}">${statusTexto}</span>
                            </td>
                            <td>
                                <button class="btn btn-edit" onclick="editarContainer('${c.id}')" style="padding: 4px 8px; font-size: 12px;">‚úèÔ∏è</button>
                                ${c.statusEntrega !== 'entregue' 
                                    ? `<button class="btn btn-status" onclick="marcarComoEntregue('${c.id}')" style="padding: 4px 8px; font-size: 12px;">‚úÖ</button>`
                                    : ''
                                }
                                <button class="btn btn-delete" onclick="excluirRegistro('${c.id}')" style="padding: 4px 8px; font-size: 12px;">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
        }

        // Abrir modal de registro
        function abrirModalRegistro() {
            document.getElementById('modalRegistro').style.display = 'block';
            editandoId = null;
            limparFormulario();
            carregarListaPOs();
        }

        // Carregar lista de POs/Lotes √∫nicos da programa√ß√£o
        function carregarListaPOs() {
            const selectPO = document.getElementById('selectPO');
            const pos = [...new Set(previsoes.map(p => p.po))].filter(po => po).sort();
            
            selectPO.innerHTML = '<option value="">Selecione uma PO</option>';
            pos.forEach(po => {
                const option = document.createElement('option');
                option.value = po;
                option.textContent = po;
                selectPO.appendChild(option);
            });
        }

        // Carregar containers de uma PO espec√≠fica
        function carregarContainersPorPO() {
            const selectPO = document.getElementById('selectPO');
            const selectContainer = document.getElementById('selectContainer');
            const poSelecionada = selectPO.value;
            
            if (!poSelecionada) {
                selectContainer.disabled = true;
                selectContainer.innerHTML = '<option value="">Selecione um container</option>';
                return;
            }
            
            // Buscar containers √∫nicos dessa PO (j√° agrupados)
            // Remover containers j√° programados (presentes em 'containers')
            const containersData = previsoes.filter(p => p.po === poSelecionada);
            // Obter pares j√° programados (refTbx + container)
            const programados = new Set(containers.map(c => `${c.refTbx}__${c.container}`));

            selectContainer.innerHTML = '<option value="">Selecione um container</option>';
            containersData.forEach(data => {
                // S√≥ mostra se ainda n√£o foi programado
                if (!programados.has(`${poSelecionada}__${data.container}`)) {
                    const option = document.createElement('option');
                    option.value = JSON.stringify({
                        container: data.container,
                        fornecedor: data.fornecedor,
                        dataEmbarque: data.dataEmbarque,
                        itens: data.itens
                    });
                    option.textContent = data.container;
                    selectContainer.appendChild(option);
                }
            });
            selectContainer.disabled = false;
        }

        // Preencher dados do container selecionado
        function preencherDadosContainer() {
            const selectPO = document.getElementById('selectPO');
            const selectContainer = document.getElementById('selectContainer');
            const containerData = selectContainer.value;
            
            if (!containerData) return;
            
            const dados = JSON.parse(containerData);
            const poSelecionada = selectPO.value;
            
            // Preencher campos
            document.getElementById('refTbx').value = poSelecionada;
            document.getElementById('container').value = dados.container;
            
            // Se tiver data de embarque, sugerir vencimento demurrage (embarque + 30 dias por exemplo)
            if (dados.dataEmbarque) {
                const dataEmbarque = new Date(dados.dataEmbarque + 'T00:00:00');
                const vencDemurrage = new Date(dataEmbarque);
                vencDemurrage.setDate(vencDemurrage.getDate() + 30);
                document.getElementById('vencimentoDemurrage').value = vencDemurrage.toISOString().split('T')[0];
                
                const vencPorto = new Date(dataEmbarque);
                vencPorto.setDate(vencPorto.getDate() + 20);
                document.getElementById('vencimentoPorto').value = vencPorto.toISOString().split('T')[0];
            }
        }

        // Fechar modal de registro
        function fecharModalRegistro() {
            document.getElementById('modalRegistro').style.display = 'none';
            editandoId = null;
            limparFormulario();
        }

        // Editar container existente
        function editarContainer(id) {
            if (!usuarioLogado) {
                alert('Fa√ßa login para editar registros.');
                return;
            }

            const container = containers.find(c => String(c.id) === String(id));
            if (!container) {
                alert('Registro n√£o encontrado para edi√ß√£o.');
                return;
            }

            // manter o id atual em edi√ß√£o
            editandoId = container.id;

            // garantir listas carregadas sem limpar o form
            carregarListaPOs();

            // preencher campos do formul√°rio com os dados existentes
            document.getElementById('refTbx').value = container.refTbx || '';
            document.getElementById('container').value = container.container || '';
            document.getElementById('vencimentoPorto').value = container.vencimentoPorto || '';
            document.getElementById('dataLiberacao').value = container.dataLiberacao || '';
            document.getElementById('dataCarregamento').value = container.dataCarregamento || '';
            document.getElementById('vencimentoDemurrage').value = container.vencimentoDemurrage || '';
            document.getElementById('entregaTbx').value = container.entregaTbx || '';
            document.getElementById('previsaoDescarregamento').value = container.previsaoDescarregamento || '';
            document.getElementById('transportadora').value = container.transportadora || '';
            document.getElementById('frete').value = container.frete ? formatarMoeda(container.frete) : '';

            // abrir modal sem resetar o estado de edi√ß√£o
            document.getElementById('modalRegistro').style.display = 'block';
        }

        // Par√¢metros de pe√ßas por pallet
        let parametrosPallet = [];
        try {
            const raw = localStorage.getItem('parametrosPallet');
            if (raw) {
                parametrosPallet = JSON.parse(raw);
                if (!Array.isArray(parametrosPallet)) parametrosPallet = [];
            }
        } catch (e) {
            parametrosPallet = [];
        }

        function atualizarTabelaParametrosPallet() {
            const tbody = document.getElementById('parametrosPalletTableBody');
            if (!tbody) return;
            if (parametrosPallet.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="empty-state"><div><div style="font-size: 3em;">üì¶</div><p>Nenhum par√¢metro cadastrado. Adicione um novo acima.</p></div></td></tr>`;
                return;
            }
            tbody.innerHTML = parametrosPallet.map((p, i) => `
                <tr>
                    <td><strong>${p.codigo}</strong></td>
                    <td>${p.quantidade}</td>
                    <td>VOL</td>
                    <td><button class="btn btn-delete" onclick="excluirParametroPallet(${i})">üóëÔ∏è Excluir</button></td>
                </tr>
            `).join('');
        }

        function excluirParametroPallet(idx) {
            if (confirm('Deseja excluir este par√¢metro?')) {
                parametrosPallet.splice(idx, 1);
                localStorage.setItem('parametrosPallet', JSON.stringify(parametrosPallet));
                atualizarTabelaParametrosPallet();
            }
        }

        document.getElementById('parametroPalletForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const codigo = document.getElementById('codigoPallet').value.trim().toUpperCase();
            const quantidade = parseInt(document.getElementById('quantidadePallet').value, 10);
            if (!codigo || !quantidade) {
                alert('Preencha todos os campos!');
                return;
            }
            if (parametrosPallet.some(p => p.codigo === codigo)) {
                alert('Este c√≥digo j√° est√° cadastrado!');
                return;
            }
            parametrosPallet.push({ codigo, quantidade });
            localStorage.setItem('parametrosPallet', JSON.stringify(parametrosPallet));
            atualizarTabelaParametrosPallet();
            e.target.reset();
        });

        // Importa√ß√£o de par√¢metros por arquivo
        const inputImportar = document.getElementById('importarParametrosPalletInput');
        if (inputImportar) {
            inputImportar.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(ev) {
                    let data, rows;
                    if (file.name.endsWith('.csv')) {
                        data = ev.target.result.split(/\r?\n/).map(l => l.split(';').map(x => x.trim()));
                        rows = data.filter(r => r[0] && r[1]);
                    } else {
                        const workbook = XLSX.read(ev.target.result, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    }
                    let count = 0;
                    rows.forEach(row => {
                        const codigo = String(row[0] || '').toUpperCase().trim();
                        const quantidade = parseInt(row[1], 10);
                        if (codigo && quantidade && !parametrosPallet.some(p => p.codigo === codigo)) {
                            parametrosPallet.push({ codigo, quantidade });
                            count++;
                        }
                    });
                    localStorage.setItem('parametrosPallet', JSON.stringify(parametrosPallet));
                    atualizarTabelaParametrosPallet();
                    alert(`‚úÖ ${count} par√¢metro(s) importado(s)!`);
                    e.target.value = '';
                };
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsArrayBuffer(file);
                }
            });
        }

        // Atualizar tabela ao carregar
        window.addEventListener('DOMContentLoaded', atualizarTabelaParametrosPallet);
    </script>
</body>
</html>